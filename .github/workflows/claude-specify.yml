# Generated by ai-ci-onboard skill — customize as needed
#
# Stage 1 of the Specify→Plan→Develop pipeline.
# Trigger: apply the "needs:specify" label to an issue.
# Claude reads the issue and writes a structured specification as a comment.
# Human reviews the spec, then applies "needs:plan" to advance.
name: "Claude - Specify"

on:
  issues:
    types: [labeled]

jobs:
  specify:
    if: github.event.label.name == 'needs:specify'
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          trigger_phrase: "needs:specify"
          prompt: |
            Issue #${{ github.event.issue.number }}: ${{ github.event.issue.title }}

            ${{ github.event.issue.body }}

            ## Your Task: Write a Specification

            Read the issue above and the project's CLAUDE.md and .claude/rules/ for context.
            Produce a structured specification comment on this issue:

            1. **Problem Statement** — what problem are we solving and why
            2. **Proposed Solution** — high-level approach
            3. **Acceptance Criteria** — bulleted, testable conditions for "done"
            4. **Out of Scope** — what this does NOT cover
            5. **Open Questions** — anything needing human input before planning

            After posting the specification:
            - Remove the label `needs:specify`
            - Add the label `review:specify`

            Use: gh issue edit ${{ github.event.issue.number }} --remove-label "needs:specify" --add-label "review:specify"
