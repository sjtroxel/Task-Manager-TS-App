# Generated by ai-ci-onboard skill — customize as needed
#
# Stage 2 of the Specify→Plan→Develop pipeline.
# Trigger: apply the "needs:plan" label to an issue (after reviewing the spec).
# Claude reads the spec and writes an implementation plan as a comment.
# Human reviews the plan, then applies "needs:develop" to advance.
name: "Claude - Plan"

on:
  issues:
    types: [labeled]

jobs:
  plan:
    if: github.event.label.name == 'needs:plan'
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          trigger_phrase: "needs:plan"
          prompt: |
            Issue #${{ github.event.issue.number }}: ${{ github.event.issue.title }}

            Read the full issue thread including the specification comment.
            Read the project's CLAUDE.md and .claude/rules/ for context.

            ## Your Task: Write an Implementation Plan

            Produce a detailed implementation plan comment:

            1. **File Changes** — every file to create, modify, or delete
            2. **Step-by-Step Tasks** — ordered checklist of implementation steps
            3. **Testing Plan** — what tests to write, what to verify
            4. **Risk / Edge Cases** — what could go wrong
            5. **Estimated Complexity** — XS / S / M / L / XL

            After posting the plan:
            - Remove the label `needs:plan`
            - Add the label `review:plan`

            Use: gh issue edit ${{ github.event.issue.number }} --remove-label "needs:plan" --add-label "review:plan"
