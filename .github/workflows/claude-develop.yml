# Generated by ai-ci-onboard skill — customize as needed
#
# Stage 3 of the Specify→Plan→Develop pipeline.
# Trigger: apply the "needs:develop" label to an issue (after reviewing the plan).
# Claude implements the code per the plan and opens a PR.
# Human reviews the PR (the final approval gate).
name: "Claude - Develop"

on:
  issues:
    types: [labeled]

jobs:
  develop:
    if: github.event.label.name == 'needs:develop'
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: write
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          trigger_phrase: "needs:develop"
          prompt: |
            Issue #${{ github.event.issue.number }}: ${{ github.event.issue.title }}

            Read the full issue thread — the specification and implementation plan are in the comments.
            Read the project's CLAUDE.md and .claude/rules/ for context.

            ## Your Task: Implement the Code

            Follow the implementation plan from the issue comments. Then:
            1. Create a feature branch named `claude/${{ github.event.issue.number }}-<short-description>`
            2. Implement all changes per the plan
            3. Write tests as specified in the plan
            4. Run existing tests to check for regressions: `cd task-manager-client && npm test`
            5. Create a PR with title referencing the issue and body containing `Closes #${{ github.event.issue.number }}`
            6. Remove the label `needs:develop` and add `review:develop`

            Use:
            ```
            gh pr create --title "<descriptive title>" --body "Closes #${{ github.event.issue.number }}"
            gh issue edit ${{ github.event.issue.number }} --remove-label "needs:develop" --add-label "review:develop"
            ```
